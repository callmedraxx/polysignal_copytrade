generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String              @id @default(uuid())
  address            String              @unique
  username           String?             @unique
  nonce              String?
  proxyWallet        String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  copySignalConfigs  CopySignalConfig[]
  copyTradingConfigs CopyTradingConfig[]
  deposits           Deposit[]
}

model Deposit {
  id              String   @id @default(uuid())
  userId          String
  onramperOrderId String?  @unique
  sourceCurrency  String
  sourceAmount    String
  targetAmount    String?
  status          String   @default("pending")
  transactionHash String?
  proxyWallet     String
  metadata        String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CopyTradingConfig {
  id                  String         @id @default(uuid())
  userId              String
  targetTraderAddress String
  copyBuyTrades       Boolean        @default(true)
  copySellTrades      Boolean        @default(true)
  amountType          String         @default("fixed")
  buyAmount           String
  sellAmount          String
  minBuyAmount        String?
  maxBuyAmount        String?
  minSellAmount       String?
  maxSellAmount       String?
  marketCategories    String?
  enabled             Boolean        @default(false)
  authorized          Boolean        @default(false)
  status              String         @default("active")
  maxBuyTradesPerDay  Int?
  tradesCountToday    Int            @default(0)
  lastResetDate       DateTime?
  durationDays        Int?
  startDate           DateTime?
  slippageTolerance   String         @default("0.05")
  maxRetries          Int            @default(3)
  traderInfo          String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  configName          String?
  allocatedUSDCAmount String
  usedUSDCAmount      String?        @default("0")
  copiedTrades        CopiedTrade[]
  user                User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  fetchedTrades       FetchedTrade[]

  @@unique([userId, targetTraderAddress])
  @@index([userId])
  @@index([targetTraderAddress])
}

model CopiedTrade {
  id               String            @id @default(uuid())
  configId         String
  originalTrader   String
  originalTxHash   String
  marketId         String
  marketQuestion   String?
  outcomeIndex     Int
  tradeType        String
  originalAmount   String
  originalPrice    String?
  originalShares   String?
  orderId          String?           @unique
  orderStatus      String?
  copiedTxHash     String?
  copiedAmount     String
  copiedPrice      String?
  copiedShares     String?
  status           String            @default("pending")
  errorMessage     String?
  submittedAt      DateTime?
  settledAt        DateTime?
  outcome          String?
  pnl              String?
  resolvedAt       DateTime?
  resolutionPrice  String?
  currentPrice     String?
  currentValue     String?
  unrealizedPnl    String?
  costBasis        String?
  lastPriceUpdate  DateTime?
  failureReason    String?
  failureCategory  String?
  redemptionStatus String?
  redemptionTxHash String?
  redeemedAt       DateTime?
  redemptionError  String?
  executedAt       DateTime?
  createdAt        DateTime          @default(now())
  config           CopyTradingConfig @relation(fields: [configId], references: [id], onDelete: Cascade)

  @@index([configId])
  @@index([originalTxHash])
  @@index([status])
  @@index([outcome])
  @@index([executedAt])
}

model SupportedAsset {
  id             String   @id @default(uuid())
  chainId        String
  chainName      String
  tokenName      String
  tokenSymbol    String
  tokenAddress   String
  tokenDecimals  Int
  minCheckoutUsd Float
  lastSyncedAt   DateTime @default(now()) @updatedAt
  createdAt      DateTime @default(now())

  @@unique([chainId, tokenAddress])
  @@index([chainId])
  @@index([tokenSymbol])
}

model FetchedTrade {
  id             String            @id @default(uuid())
  configId       String
  originalTxHash String
  traderAddress  String
  marketId       String?
  timestamp      String?
  side           String?
  processed      Boolean           @default(false)
  skippedReason  String?
  createdAt      DateTime          @default(now())
  config         CopyTradingConfig @relation(fields: [configId], references: [id], onDelete: Cascade)

  @@unique([configId, originalTxHash])
  @@index([configId])
  @@index([originalTxHash])
  @@index([processed])
  @@index([createdAt])
}

model CopySignalConfig {
  id                  String         @id @default(uuid())
  userId              String
  signalCategories    String
  copyBuyTrades       Boolean        @default(true)
  copySellTrades      Boolean        @default(true)
  amountType          String         @default("fixed")
  buyAmount           String
  sellAmount          String
  minBuyAmount        String?
  maxBuyAmount        String?
  minSellAmount       String?
  maxSellAmount       String?
  marketCategories    String?
  enabled             Boolean        @default(false)
  authorized          Boolean        @default(false)
  slippageTolerance   String         @default("0.05")
  maxRetries          Int            @default(3)
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  allocatedUSDCAmount String
  usedUSDCAmount      String?        @default("0")
  copiedSignals       CopiedSignal[]
  user                User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([enabled])
}

model CopiedSignal {
  id               String           @id @default(uuid())
  configId         String
  signalId         String
  category         String
  originalTxHash   String?
  marketId         String
  marketQuestion   String?
  outcomeIndex     Int
  tradeType        String
  originalAmount   String
  originalPrice    String?
  originalShares   String?
  orderId          String?          @unique
  orderStatus      String?
  copiedTxHash     String?
  copiedAmount     String
  copiedPrice      String?
  copiedShares     String?
  status           String           @default("pending")
  errorMessage     String?
  submittedAt      DateTime?
  settledAt        DateTime?
  outcome          String?
  pnl              String?
  resolvedAt       DateTime?
  resolutionPrice  String?
  currentPrice     String?
  currentValue     String?
  unrealizedPnl    String?
  costBasis        String?
  lastPriceUpdate  DateTime?
  failureReason    String?
  failureCategory  String?
  redemptionStatus String?
  redemptionTxHash String?
  redeemedAt       DateTime?
  redemptionError  String?
  executedAt       DateTime?
  createdAt        DateTime         @default(now())
  config           CopySignalConfig @relation(fields: [configId], references: [id], onDelete: Cascade)

  @@index([configId])
  @@index([signalId])
  @@index([category])
  @@index([status])
  @@index([outcome])
  @@index([executedAt])
}

model adminjs_session {
  sid    String   @id(map: "session_pkey") @db.VarChar
  sess   Json     @db.Json
  expire DateTime @db.Timestamp(6)

  @@index([expire], map: "IDX_session_expire")
}
